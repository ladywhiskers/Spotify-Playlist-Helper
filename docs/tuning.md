# Расширенная настройка

## Обновление

### Обновить библиотеку

Замените все содержимое файла `library.gs` на новое <kbd>Ctrl</kbd><kbd>A</kbd> и <kbd>Ctrl</kbd><kbd>V</kbd>, которое берется [здесь](https://github.com/Chimildic/goofy/blob/main/library.js) или [здесь](https://script.google.com/d/1DnC4H7yjqPV2unMZ_nmB-1bDSJT9wQUJ7Wq-ijF4Nc7Fl3qnbT0FkPSr/edit?usp=sharing) <kbd>Ctrl</kbd><kbd>A</kbd> и <kbd>Ctrl</kbd><kbd>C</kbd> и сохраните файл.

### Обновить параметры

1. Измените требуемый параметр в файле `config.gs` (актуальный список находится [здесь](https://github.com/Chimildic/goofy/blob/main/config.js))
2. Запустите в редакторе функцию `setProperties`

### Обновить права доступа

При расширении функций библиотеки, могут потребоваться дополнительные права доступа. Например, на загрузку изображения или доступ к любимым трекам. При такой необходимости, в [списке изменений](/changelog.md) очередного обновления будут указания на обновление прав доступа.

1. Вставьте следующую функцию и запустите в редакторе один раз. После можно ее удалить.
    ```js
    function resetAuth(){
        Auth.reset();
    }
    ```
2. Нажмите в верхнем меню редактора `начать развертывание` - `пробные развертывания`
3. Скопируйте ссылку из открывшегося окна и перейдите по ней в новой вкладке
4. Нажмите `Authorize` и подтвердите новые права доступа

## Часовой пояс

Чтобы работать с датами в вашем часовом поясе, выполните следующие шаги:

1. Найдите свой часовой пояс [здесь](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones). Нужно значение из второй колонки. Например, `Europe/Moscow`.
2. Зайдите в настройки проекта (меню слева), поставьте галку напротив `Показывать файл манифеста appsscript.json в редакторе`.
3. Перейдите в файл `appsscript.json` и поменяйте значение у `timeZone` на ваше, сохраните изменение.
4. Вернитесь в настройки проекта и отключите видимость файла `appsscript.json`.

## Настройка last.fm

Необходимо для модуля [Last.fm](/reference/lastfm). Если не используется, выполнять не нужно.

1. Подключите Spotify к Last.fm [здесь](https://www.last.fm/settings/applications)
2. Создайте точку входа [здесь](https://www.last.fm/api/account/create). Заполните название и описание произвольно. Остальное пропустить, оставить пустым.
3. Полученный `API key` присвоить параметру `LASTFM_API_KEY`. Также укажите свой логин в `LASTFM_LOGIN`. И задайте `true` для `ON_LASTFM_RECENT_TRACKS`.
4. Запустить в редакторе выполнение функции `setProperties`.

![Lastfm account api](/img/lastfm_account_api3.png)

## Настройка musicmatch

Необходимо для функции [detectLanguage](/reference/filter?id=detectlanguage). Если не используется, выполнять не нужно. 

1. Зайдите на сайт [developer.musixmatch.com](https://developer.musixmatch.com/signup), чтобы зарегистрироваться и получить API ключ. Телефон и адрес заполните произвольно (123 и World, к примеру). Почта реальная, попросит подтвердить.  
2. После подтверждения почты зайдите в [дэшборд приложений](https://developer.musixmatch.com/admin/applications). Скопируйте ключ.  
3. Вставьте в параметры из файла `config` и запустите функцию `setProperties`.
